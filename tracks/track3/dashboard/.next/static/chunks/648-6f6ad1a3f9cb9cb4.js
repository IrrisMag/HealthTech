"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[648],{3648:function(e,t,r){r.d(t,{Z:function(){return u}});var s=r(7437),a=r(2265),i=r(429),n=r(3639),o=r(1723),c=r(5302),l=r(340),d=r(5252),m=r(2208),h=r(3276),x=r(9116);function u(e){let{data:t}=e,[r,u]=(0,a.useState)(new Set),[p,g]=(0,a.useState)(null),y=e=>{g(e)},f=async e=>{if(!r.has(e.id)){u(t=>new Set(t).add(e.id));try{await (0,x.LP)(e.id),alert("Order executed successfully for ".concat(e.blood_type," - ").concat(e.action))}catch(e){alert("Failed to execute order: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{u(t=>{let r=new Set(t);return r.delete(e.id),r})}}};if(!t)return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Optimization Recommendations"})}),(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},t))})]});let _=e=>{switch(e){case"emergency":case"critical":return n.Z;case"high":return o.Z;default:return c.Z}},v=e=>{switch(e){case"emergency":case"critical":return"text-red-600 bg-red-100";case"high":return"text-orange-600 bg-orange-100";case"medium":return"text-yellow-600 bg-yellow-100";default:return"text-green-600 bg-green-100"}},b=e=>{switch(e){case"emergency_order":return n.Z;case"routine_order":return l.Z;default:return c.Z}},j=e=>({"A+":"bg-red-500","A-":"bg-red-600","B+":"bg-blue-500","B-":"bg-blue-600","AB+":"bg-purple-500","AB-":"bg-purple-600","O+":"bg-orange-500","O-":"bg-orange-600"})[e]||"bg-gray-500";return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Optimization Recommendations"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Real-time"})]})]}),0===t.recommendations.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(c.Z,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),(0,s.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"All Good!"}),(0,s.jsx)("p",{className:"text-gray-600",children:"No optimization recommendations at this time."})]}):(0,s.jsx)("div",{className:"space-y-4",children:t.recommendations.map((e,t)=>{let a=_(e.priority_level);return b(e.recommendation_type),(0,s.jsxs)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg ".concat(v(e.priority_level)),children:(0,s.jsx)(a,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium text-white ".concat(j(e.blood_type)),children:e.blood_type}),(0,s.jsx)("span",{className:"status-indicator ".concat("emergency"===e.priority_level||"critical"===e.priority_level?"status-critical":"high"===e.priority_level?"bg-orange-100 text-orange-800":"status-adequate"),children:e.priority_level.toUpperCase()})]}),(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:e.recommendation_type.replace("_"," ").toUpperCase()})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Confidence"}),(0,s.jsxs)("div",{className:"text-lg font-semibold text-gray-900",children:[(100*e.confidence_score).toFixed(0),"%"]})]})]}),(0,s.jsx)("p",{className:"text-gray-700 mb-4",children:e.reasoning}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(l.Z,{className:"w-4 h-4 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Order Quantity"}),(0,s.jsxs)("div",{className:"font-medium",children:[e.recommended_order_quantity," units"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Estimated Cost"}),(0,s.jsxs)("div",{className:"font-medium",children:["$",e.cost_estimate.toLocaleString()]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Expected Delivery"}),(0,s.jsx)("div",{className:"font-medium",children:new Date(e.expected_delivery_date).toLocaleDateString()})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["Generated ",new Date(e.created_at).toLocaleString()]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>y(e),className:"px-3 py-1 text-xs font-medium text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors flex items-center space-x-1",children:[(0,s.jsx)(m.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:"View Details"})]}),(0,s.jsxs)("button",{onClick:()=>f(e),disabled:r.has(e.id),className:"px-3 py-1 text-xs font-medium text-white rounded transition-colors flex items-center space-x-1 ".concat(r.has(e.id)?"bg-gray-400 cursor-not-allowed":"emergency"===e.priority_level||"critical"===e.priority_level?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,s.jsx)(h.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:r.has(e.id)?"Executing...":"Execute Order"})]})]})]})]},e.recommendation_id)})}),t.recommendations.length>0&&(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:t.recommendations.filter(e=>"emergency"===e.priority_level||"critical"===e.priority_level).length}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Critical Actions"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",t.recommendations.reduce((e,t)=>e+t.cost_estimate,0).toLocaleString()]}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Total Cost"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:t.recommendations.reduce((e,t)=>e+t.recommended_order_quantity,0)}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Total Units"})]})]})}),p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Recommendation Details"}),(0,s.jsx)("button",{onClick:()=>g(null),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Blood Type"}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:p.blood_type})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Priority"}),(0,s.jsx)("p",{className:"text-lg font-semibold ".concat(v(p.priority_level)),children:p.priority_level.toUpperCase()})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Action Required"}),(0,s.jsx)("p",{className:"text-gray-900",children:p.action})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Reason"}),(0,s.jsx)("p",{className:"text-gray-700",children:p.reason})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Recommended Quantity"}),(0,s.jsxs)("p",{className:"text-lg font-semibold",children:[p.recommended_order_quantity," units"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Cost Estimate"}),(0,s.jsxs)("p",{className:"text-lg font-semibold",children:["$",p.cost_estimate.toLocaleString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Expected Delivery"}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:p.expected_delivery_time})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Generated"}),(0,s.jsx)("p",{className:"text-gray-700",children:new Date(p.created_at).toLocaleString()})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>g(null),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors",children:"Close"}),(0,s.jsx)("button",{onClick:()=>{f(p),g(null)},disabled:r.has(p.id),className:"px-4 py-2 text-white rounded transition-colors ".concat(r.has(p.id)?"bg-gray-400 cursor-not-allowed":"emergency"===p.priority_level||"critical"===p.priority_level?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:r.has(p.id)?"Executing...":"Execute Order"})]})]})})]})}},9116:function(e,t,r){r.d(t,{LP:function(){return b},Mf:function(){return g},OE:function(){return j},PM:function(){return p},RT:function(){return u},a7:function(){return y},nz:function(){return h},wS:function(){return x}});var s=r(3464);let a=r(257).env.NEXT_PUBLIC_TRACK3_API_URL||"https://healthtech-production-e602.up.railway.app",i=s.Z.create({baseURL:a,timeout:15e3,headers:{"Content-Type":"application/json"}}),n=s.Z.create({baseURL:"https://healthtech-production-e602.up.railway.app",timeout:1e4,headers:{"Content-Type":"application/json"}}),o=s.Z.create({baseURL:"https://healthtech-production-e602.up.railway.app",timeout:15e3,headers:{"Content-Type":"application/json"}}),c=s.Z.create({baseURL:"https://healthtech-production-e602.up.railway.app",timeout:1e4,headers:{"Content-Type":"application/json"}}),l=e=>{let t=localStorage.getItem("access_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e};i.interceptors.request.use(l),n.interceptors.request.use(l),o.interceptors.request.use(l),c.interceptors.request.use(l);let d=async()=>{try{let e=(await i.get("/dashboard/metrics")).data;if("success"===e.status&&e.data)return{total_donors:e.data.total_donors,total_donations_today:e.data.total_donations_today,total_donations_this_month:e.data.total_donations_this_month,total_inventory_units:e.data.total_inventory_units,units_expiring_soon:e.data.units_expiring_soon,pending_requests:e.data.pending_requests,emergency_requests:e.data.emergency_requests,blood_type_distribution:e.data.blood_type_distribution,component_distribution:e.data.component_distribution,last_updated:e.data.last_updated};throw Error("Invalid response format from dashboard metrics API")}catch(e){throw console.error("Error fetching dashboard metrics:",e),Error("Failed to fetch dashboard metrics. Please check if the data service is running.")}},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{let t=(await i.get("/analytics/performance?days=".concat(e))).data;if("success"===t.status)return{performance_metrics:t.performance_metrics,recent_improvements:t.recent_improvements,timestamp:t.timestamp};throw Error("Invalid response format from analytics API")}catch(e){throw console.error("Error fetching historical metrics:",e),Error("Failed to fetch analytics data. Please check if the analytics service is running.")}},h=async()=>{try{let e=(await i.get("/inventory")).data;if("success"===e.status&&e.inventory)return e.inventory;throw Error("Invalid response format from inventory API")}catch(e){throw console.error("Error fetching blood inventory:",e),Error("Failed to fetch blood inventory. Please check if the data service is running.")}},x=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{try{console.log("\uD83D\uDD04 Attempting batch forecast...");let t=["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(async t=>{try{let r=(await i.get("/forecast/".concat(encodeURIComponent(t),"?periods=").concat(e))).data;if("success"===r.status&&r.forecasts)return r.forecasts.map(e=>({blood_type:t,date:e.date,predicted_demand:e.predicted_demand,confidence_interval_lower:e.lower_bound,confidence_interval_upper:e.upper_bound}));return[]}catch(e){return console.error("❌ Error fetching forecast for ".concat(t,":"),e),[]}}),r=(await Promise.all(t)).flat();if(0===r.length)throw Error("No forecast data available from any blood type");return console.log("✅ Successfully loaded ".concat(r.length," forecast records using real ARIMA models")),r}catch(e){throw console.error("❌ Batch forecast failed:",e),e}}catch(e){throw console.error("❌ Error fetching forecasts:",e),Error("Failed to fetch forecast data. Please check if the forecasting service is running.")}},u=async()=>{try{let e=(await i.get("/recommendations/active")).data;if("success"===e.status&&e.recommendations)return e.recommendations;throw Error("Invalid response format from recommendations API")}catch(e){throw console.error("Error fetching optimization recommendations:",e),Error("Failed to fetch optimization recommendations. Please check if the optimization service is running.")}},p=async()=>{try{let e=(await i.get("/donors")).data;if("success"===e.status&&e.donors)return e.donors;throw Error("Invalid response format from donors API")}catch(e){throw console.error("Error fetching donors:",e),Error("Failed to fetch donors data. Please check if the data service is running.")}},g=async()=>{try{let e=(await i.post("/optimize")).data;if("success"===e.status)return e;throw Error("Invalid response format from optimization API")}catch(e){throw console.error("Error triggering optimization:",e),Error("Failed to trigger optimization. Please check if the optimization service is running.")}},y=async()=>{try{let[e,t,r,s,a]=await Promise.all([d(),h(),x(),u(),m(7)]),i=f(t),n=v(i,s),o=_(e,a);return{metrics:e,blood_types:i,forecasts:r,recommendations:s,alerts:n,trends:o}}catch(e){throw console.error("Error fetching dashboard data:",e),Error("Failed to fetch dashboard data. Please check if all backend services are running.")}},f=e=>["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(t=>{let r;let s=e.filter(e=>e.blood_type===t).length;return r=s<=5?"critical":s<=15?"low":s<=30?"adequate":s<=40?"optimal":"excess",{type:t,current_stock:s,safety_stock:20,reorder_point:15,days_until_expiry:Math.floor(30*Math.random())+1,status:r,trend:["increasing","decreasing","stable"][Math.floor(3*Math.random())]}}),_=(e,t)=>{if(!t||0===t.length)return{total_donors:{value:"+12%",isPositive:!0},total_donations_today:{value:"+5",isPositive:!0},total_inventory_units:{value:"-2%",isPositive:!1},units_expiring_soon:{value:"+3",isPositive:!1},pending_requests:{value:"-1",isPositive:!0},emergency_requests:{value:"0",isPositive:!0},total_donations_this_month:{value:"+18%",isPositive:!0}};let r=t[0],s=(e,t)=>{if(0===t)return{value:"N/A",isPositive:!0};let r=(e-t)/t*100;return{value:"".concat(r>=0?"+":"").concat(r.toFixed(1),"%"),isPositive:r>=0}},a=(e,t)=>{let r=e-t;return{value:"".concat(r>=0?"+":"").concat(r),isPositive:r>=0}};return{total_donors:s(e.total_donors,r.total_donors),total_donations_today:a(e.total_donations_today,r.total_donations_today),total_inventory_units:s(e.total_inventory_units,r.total_inventory_units),units_expiring_soon:a(e.units_expiring_soon,r.units_expiring_soon),pending_requests:a(e.pending_requests,r.pending_requests),emergency_requests:a(e.emergency_requests,r.emergency_requests),total_donations_this_month:s(e.total_donations_this_month,r.total_donations_this_month)}},v=(e,t)=>{let r=[];return e.forEach(e=>{"critical"===e.status&&r.push({id:"critical-".concat(e.type),type:"critical",title:"Critical Stock Level",message:"".concat(e.type," blood type has critically low stock (").concat(e.current_stock," units)"),blood_type:e.type,timestamp:new Date().toISOString(),acknowledged:!1})}),t.forEach(e=>{"emergency"===e.priority_level&&r.push({id:"emergency-".concat(e.recommendation_id),type:"critical",title:"Emergency Order Required",message:e.reasoning,blood_type:e.blood_type,timestamp:e.created_at,acknowledged:!1})}),r},b=async e=>{try{return(await i.post("/optimization/execute/".concat(e))).data}catch(e){throw console.error("Failed to execute optimization order:",e),Error("Failed to execute optimization order. Please check if the optimization service is running.")}},j=async(e,t)=>{try{return(await i.post("/reports/generate",{type:e,filters:t||{},format:"pdf"})).data}catch(e){throw console.error("Failed to generate report:",e),Error("Failed to generate report. Please check if the reporting service is running.")}}}}]);