(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7314:function(t,e,a){Promise.resolve().then(a.bind(a,2722))},2722:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return _}});var r=a(7437),s=a(2265),n=a(429),l=a(5805),i=a(7829),o=a(1723),c=a(3639),d=a(525),m=a(3085);function u(t){let{data:e}=t;if(!e)return(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(8)].map((t,e)=>(0,r.jsxs)("div",{className:"metric-card animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]},e))});let a=[{title:"Total Donors",value:e.metrics.total_donors.toLocaleString(),icon:l.Z,color:"text-blue-600",bgColor:"bg-blue-100",trend:"+12%",trendUp:!0},{title:"Donations Today",value:e.metrics.total_donations_today.toString(),icon:i.Z,color:"text-green-600",bgColor:"bg-green-100",trend:"+5",trendUp:!0},{title:"Total Inventory",value:e.metrics.total_inventory_units.toLocaleString(),icon:i.Z,color:"text-purple-600",bgColor:"bg-purple-100",trend:"-2%",trendUp:!1},{title:"Expiring Soon",value:e.metrics.units_expiring_soon.toString(),icon:o.Z,color:"text-yellow-600",bgColor:"bg-yellow-100",trend:"+3",trendUp:!1},{title:"Pending Requests",value:e.metrics.pending_requests.toString(),icon:c.Z,color:"text-orange-600",bgColor:"bg-orange-100",trend:"-1",trendUp:!0},{title:"Emergency Requests",value:e.metrics.emergency_requests.toString(),icon:c.Z,color:"text-red-600",bgColor:"bg-red-100",trend:"0",trendUp:!0},{title:"This Month",value:e.metrics.total_donations_this_month.toLocaleString(),icon:d.Z,color:"text-indigo-600",bgColor:"bg-indigo-100",trend:"+18%",trendUp:!0},{title:"Active Alerts",value:e.alerts.filter(t=>!t.acknowledged).length.toString(),icon:c.Z,color:"text-red-600",bgColor:"bg-red-100",trend:e.alerts.length>0?"High":"Low",trendUp:0===e.alerts.length}];return(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:a.map((t,e)=>(0,r.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*e},className:"metric-card group hover:shadow-lg transition-all duration-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:t.title}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:t.value}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[t.trendUp?(0,r.jsx)(d.Z,{className:"w-4 h-4 text-green-500"}):(0,r.jsx)(m.Z,{className:"w-4 h-4 text-red-500"}),(0,r.jsx)("span",{className:"text-xs font-medium ".concat(t.trendUp?"text-green-600":"text-red-600"),children:t.trend}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"vs last week"})]})]}),(0,r.jsx)("div",{className:"p-3 rounded-lg ".concat(t.bgColor," group-hover:scale-110 transition-transform duration-200"),children:(0,r.jsx)(t.icon,{className:"w-6 h-6 ".concat(t.color)})})]})},t.title))})}var p=a(5513);function x(t){let{data:e}=t,a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!e||!a.current)return;let t=p.Ys(a.current);t.selectAll("*").remove();let r={top:20,right:30,bottom:40,left:60},s=600-r.left-r.right,n=400-r.top-r.bottom,l=t.attr("width",s+r.left+r.right).attr("height",n+r.top+r.bottom).append("g").attr("transform","translate(".concat(r.left,",").concat(r.top,")")),i=e.blood_types.map(t=>({type:t.type,current:t.current_stock,safety:t.safety_stock,reorder:t.reorder_point,status:t.status})),o=p.PKp().domain(["critical","low","adequate","optimal","excess"]).range(["#dc2626","#f59e0b","#10b981","#059669","#6366f1"]),c=p.tiA().domain(i.map(t=>t.type)).range([0,s]).padding(.2),d=p.BYU().domain([0,p.Fp7(i,t=>Math.max(t.current,t.safety))||100]).nice().range([n,0]);l.append("g").attr("transform","translate(0,".concat(n,")")).call(p.LLu(c)).selectAll("text").style("font-size","12px").style("font-weight","bold"),l.append("g").call(p.y4O(d)).selectAll("text").style("font-size","11px"),l.append("text").attr("transform","rotate(-90)").attr("y",0-r.left).attr("x",0-n/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").style("fill","#6b7280").text("Units in Stock"),l.append("text").attr("transform","translate(".concat(s/2,", ").concat(n+r.bottom,")")).style("text-anchor","middle").style("font-size","12px").style("fill","#6b7280").text("Blood Type"),l.selectAll(".safety-line").data(i).enter().append("line").attr("class","safety-line").attr("x1",t=>c(t.type)||0).attr("x2",t=>(c(t.type)||0)+c.bandwidth()).attr("y1",t=>d(t.safety)).attr("y2",t=>d(t.safety)).attr("stroke","#f59e0b").attr("stroke-width",2).attr("stroke-dasharray","5,5"),l.selectAll(".reorder-line").data(i).enter().append("line").attr("class","reorder-line").attr("x1",t=>c(t.type)||0).attr("x2",t=>(c(t.type)||0)+c.bandwidth()).attr("y1",t=>d(t.reorder)).attr("y2",t=>d(t.reorder)).attr("stroke","#dc2626").attr("stroke-width",2).attr("stroke-dasharray","3,3");let m=l.selectAll(".bar").data(i).enter().append("rect").attr("class","bar").attr("x",t=>c(t.type)||0).attr("width",c.bandwidth()).attr("y",n).attr("height",0).attr("fill",t=>o(t.status)).attr("rx",4).attr("ry",4);m.transition().duration(1e3).delay((t,e)=>100*e).attr("y",t=>d(t.current)).attr("height",t=>n-d(t.current)),l.selectAll(".bar-label").data(i).enter().append("text").attr("class","bar-label").attr("x",t=>(c(t.type)||0)+c.bandwidth()/2).attr("y",t=>d(t.current)-5).attr("text-anchor","middle").style("font-size","11px").style("font-weight","bold").style("fill","#374151").text(t=>t.current).style("opacity",0).transition().duration(1e3).delay((t,e)=>100*e+500).style("opacity",1);let u=l.append("g").attr("transform","translate(".concat(s-150,", 20)"));[{label:"Safety Stock",color:"#f59e0b",type:"line"},{label:"Reorder Point",color:"#dc2626",type:"line"}].forEach((t,e)=>{let a=u.append("g").attr("transform","translate(0, ".concat(20*e,")"));"line"===t.type&&a.append("line").attr("x1",0).attr("x2",15).attr("y1",5).attr("y2",5).attr("stroke",t.color).attr("stroke-width",2).attr("stroke-dasharray",0===e?"5,5":"3,3"),a.append("text").attr("x",20).attr("y",5).attr("dy","0.35em").style("font-size","11px").style("fill","#6b7280").text(t.label)});let x=p.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000");return m.on("mouseover",function(t,e){p.Ys(this).attr("opacity",.8),x.style("visibility","visible").html("\n            <strong>".concat(e.type,"</strong><br/>\n            Current: ").concat(e.current," units<br/>\n            Safety: ").concat(e.safety," units<br/>\n            Reorder: ").concat(e.reorder," units<br/>\n            Status: ").concat(e.status,"\n          "))}).on("mousemove",function(t){x.style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")}).on("mouseout",function(){p.Ys(this).attr("opacity",1),x.style("visibility","hidden")}),()=>{p.Ys("body").selectAll(".tooltip").remove()}},[e]),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"card-header",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Blood Inventory Levels"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-3 h-0.5 bg-yellow-500",style:{borderStyle:"dashed"}}),(0,r.jsx)("span",{children:"Safety Stock"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-3 h-0.5 bg-red-500",style:{borderStyle:"dashed"}}),(0,r.jsx)("span",{children:"Reorder Point"})]})]})]}),(0,r.jsx)("div",{className:"chart-container",children:(0,r.jsx)("svg",{ref:a,className:"w-full h-full"})})]})}var h=a(2521),y=a(3648),g=a(5095),f=a(3245),b=a(4766),v=a(2489),j=a(1239);function w(t){let{data:e}=t,[a,l]=(0,s.useState)(new Set);if(!e)return null;let i=e.alerts.filter(t=>!t.acknowledged&&!a.has(t.id)),o=t=>{l(e=>new Set([...e,t]))},d=t=>{"critical"===t.type?t.message.includes("stock")?t("Emergency order initiated for ".concat(t.blood_type||"blood products",". Contacting suppliers...")):t.message.includes("expir")?t("Expiring products alert handled. Notifying relevant departments..."):t("Critical action taken for alert: ".concat(t.message)):t("Action taken for alert: ".concat(t.message)),o(t.id)},m=t=>{switch(t){case"critical":case"warning":return c.Z;default:return f.Z}},u=t=>{switch(t){case"critical":return{container:"bg-red-50 border-red-200",icon:"text-red-600",title:"text-red-800",message:"text-red-700",button:"text-red-600 hover:text-red-800"};case"warning":return{container:"bg-yellow-50 border-yellow-200",icon:"text-yellow-600",title:"text-yellow-800",message:"text-yellow-700",button:"text-yellow-600 hover:text-yellow-800"};default:return{container:"bg-blue-50 border-blue-200",icon:"text-blue-600",title:"text-blue-800",message:"text-blue-700",button:"text-blue-600 hover:text-blue-800"}}};return 0===i.length?(0,r.jsx)(n.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(b.Z,{className:"h-5 w-5 text-green-600"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"All Systems Normal"}),(0,r.jsx)("p",{className:"text-sm text-green-700",children:"No active alerts. Blood bank operations are running smoothly."})]})]})}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(g.M,{children:i.map((t,e)=>{let a=m(t.type),s=u(t.type);return(0,r.jsx)(n.E.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{delay:.1*e},className:"border rounded-lg p-4 ".concat(s.container),children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(a,{className:"h-5 w-5 ".concat(s.icon," ").concat("critical"===t.type?"animate-pulse":"")})}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium ".concat(s.title),children:[t.title,t.blood_type&&(0,r.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-white text-gray-800",children:t.blood_type})]}),(0,r.jsx)("button",{onClick:()=>o(t.id),className:"ml-2 flex-shrink-0 ".concat(s.button," transition-colors"),children:(0,r.jsx)(v.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)("p",{className:"mt-1 text-sm ".concat(s.message),children:t.message}),(0,r.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:new Date(t.timestamp).toLocaleString()}),"critical"===t.type&&(0,r.jsxs)(n.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d(t),className:"text-xs font-medium text-white bg-red-600 hover:bg-red-700 px-3 py-1 rounded transition-colors flex items-center space-x-1",children:[(0,r.jsx)(j.Z,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Take Action"})]})]})]})]})},t.id)})}),i.length>0&&(0,r.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:[i.length," active alert",1!==i.length?"s":""]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-gray-600",children:[i.filter(t=>"critical"===t.type).length," Critical"]})]}),(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-gray-600",children:[i.filter(t=>"warning"===t.type).length," Warning"]})]}),(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-gray-600",children:[i.filter(t=>"info"===t.type).length," Info"]})]})]})]})})]})}var N=a(9116),k=a(1137);function _(){let{user:t}=(0,k.a)();if(!t)return null;let[e,a]=(0,s.useState)(null),[l,i]=(0,s.useState)(!0),[o,c]=(0,s.useState)(null),[d,m]=(0,s.useState)(new Date),[p,g]=(0,s.useState)(!1),[f,b]=(0,s.useState)(null);(0,s.useEffect)(()=>{v();let t=setInterval(v,3e4);return()=>clearInterval(t)},[]);let v=async()=>{try{c(null);let t=await (0,N.a7)();a(t),m(new Date)}catch(t){c(t instanceof Error?t.message:"Failed to load dashboard data")}finally{i(!1)}},j=async()=>{try{var t,e;g(!0),c(null),console.log("\uD83D\uDD04 Triggering real-time optimization...");let a=await (0,N.Mf)();b(a),console.log("✅ Optimization completed:",a),await v(),alert("Optimization completed successfully! Generated ".concat((null===(e=a.optimization_results)||void 0===e?void 0:null===(t=e.recommendations)||void 0===t?void 0:t.length)||0," new recommendations."))}catch(t){console.error("❌ Optimization failed:",t),c(t instanceof Error?t.message:"Failed to trigger optimization")}finally{g(!1)}};return l?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading blood bank dashboard..."})]})}):o?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Dashboard Error"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:o}),(0,r.jsx)("button",{onClick:v,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Retry"})]})}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)(n.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83E\uDE78 Blood Bank Dashboard"}),(0,r.jsx)("p",{className:"text-gray-600",children:"AI-Enhanced Stock Monitoring & Forecasting - Douala General Hospital"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:j,disabled:p,className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(p?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Optimizing..."]}):(0,r.jsx)(r.Fragment,{children:"\uD83D\uDE80 Run Optimization"})}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Last updated"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:d.toLocaleTimeString()})]})]})]})}),(0,r.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-8",children:(0,r.jsx)(w,{data:e})}),(0,r.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-8",children:(0,r.jsx)(u,{data:e})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[(0,r.jsx)(n.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},children:(0,r.jsx)(x,{data:e})}),(0,r.jsx)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},children:(0,r.jsx)(h.Z,{data:e})})]}),(0,r.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:(0,r.jsx)(y.Z,{data:e})})]})}},2521:function(t,e,a){"use strict";a.d(e,{Z:function(){return l}});var r=a(7437),s=a(2265),n=a(5513);function l(t){let{data:e}=t,a=(0,s.useRef)(null),[l,i]=(0,s.useState)("O+");return(0,s.useEffect)(()=>{var t;if(!e||!a.current)return;let r=n.Ys(a.current);r.selectAll("*").remove();let s={top:20,right:30,bottom:40,left:60},i=600-s.left-s.right,o=400-s.top-s.bottom,c=r.attr("width",i+s.left+s.right).attr("height",o+s.top+s.bottom).append("g").attr("transform","translate(".concat(s.left,",").concat(s.top,")")),d=e.forecasts.filter(t=>t.blood_type===l).sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime());if(0===d.length)return;let m=n.Z1g("%Y-%m-%d"),u=d.map(t=>({...t,parsedDate:m(t.date)||new Date})),p=n.Xf().domain(n.Wem(u,t=>t.parsedDate)).range([0,i]),x=n.BYU().domain([0,n.Fp7(u,t=>Math.max(t.predicted_demand,t.confidence_interval_upper))||50]).nice().range([o,0]),h=n.jvg().x(t=>p(t.parsedDate)).y(t=>x(t.predicted_demand)).curve(n.FdL),y=n.jvg().x(t=>p(t.parsedDate)).y(t=>x(t.confidence_interval_upper)).curve(n.FdL),g=n.jvg().x(t=>p(t.parsedDate)).y(t=>x(t.confidence_interval_lower)).curve(n.FdL),f=n.SOn().x(t=>p(t.parsedDate)).y0(t=>x(t.confidence_interval_lower)).y1(t=>x(t.confidence_interval_upper)).curve(n.FdL);c.append("g").attr("transform","translate(0,".concat(o,")")).call(n.LLu(p).tickFormat(n.i$Z("%m/%d")).ticks(5)).selectAll("text").style("font-size","11px"),c.append("g").call(n.y4O(x)).selectAll("text").style("font-size","11px"),c.append("text").attr("transform","rotate(-90)").attr("y",0-s.left).attr("x",0-o/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").style("fill","#6b7280").text("Predicted Demand (Units)"),c.append("text").attr("transform","translate(".concat(i/2,", ").concat(o+s.bottom,")")).style("text-anchor","middle").style("font-size","12px").style("fill","#6b7280").text("Date"),c.append("path").datum(u).attr("fill","#3b82f6").attr("fill-opacity",.2).attr("d",f),c.append("path").datum(u).attr("fill","none").attr("stroke","#93c5fd").attr("stroke-width",1).attr("stroke-dasharray","3,3").attr("d",y),c.append("path").datum(u).attr("fill","none").attr("stroke","#93c5fd").attr("stroke-width",1).attr("stroke-dasharray","3,3").attr("d",g);let b=c.append("path").datum(u).attr("fill","none").attr("stroke","#2563eb").attr("stroke-width",3).attr("d",h),v=(null===(t=b.node())||void 0===t?void 0:t.getTotalLength())||0;b.attr("stroke-dasharray",v+" "+v).attr("stroke-dashoffset",v).transition().duration(2e3).ease(n.Nyw).attr("stroke-dashoffset",0),c.selectAll(".dot").data(u).enter().append("circle").attr("class","dot").attr("cx",t=>p(t.parsedDate)).attr("cy",t=>x(t.predicted_demand)).attr("r",0).attr("fill","#1d4ed8").transition().duration(1e3).delay((t,e)=>100*e).attr("r",4);let j=n.Ys("body").append("div").attr("class","forecast-tooltip").style("position","absolute").style("visibility","hidden").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000");c.selectAll(".dot").on("mouseover",function(t,e){n.Ys(this).attr("r",6).attr("fill","#1e40af"),j.style("visibility","visible").html("\n            <strong>".concat(l," - ").concat(e.date,"</strong><br/>\n            Predicted: ").concat(e.predicted_demand.toFixed(1)," units<br/>\n            Range: ").concat(e.confidence_interval_lower.toFixed(1)," - ").concat(e.confidence_interval_upper.toFixed(1),"\n          "))}).on("mousemove",function(t){j.style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")}).on("mouseout",function(){n.Ys(this).attr("r",4).attr("fill","#1d4ed8"),j.style("visibility","hidden")});let w=c.append("g").attr("transform","translate(".concat(i-150,", 20)"));return[{label:"Forecast",color:"#2563eb",type:"line"},{label:"Confidence Interval",color:"#3b82f6",type:"area"}].forEach((t,e)=>{let a=w.append("g").attr("transform","translate(0, ".concat(20*e,")"));"line"===t.type?a.append("line").attr("x1",0).attr("x2",15).attr("y1",5).attr("y2",5).attr("stroke",t.color).attr("stroke-width",3):a.append("rect").attr("x",0).attr("y",0).attr("width",15).attr("height",10).attr("fill",t.color).attr("fill-opacity",.2),a.append("text").attr("x",20).attr("y",5).attr("dy","0.35em").style("font-size","11px").style("fill","#6b7280").text(t.label)}),()=>{n.Ys("body").selectAll(".forecast-tooltip").remove()}},[e,l]),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"card-header",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Demand Forecasting"}),(0,r.jsx)("select",{value:l,onChange:t=>i(t.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(t=>(0,r.jsx)("option",{value:t,children:t},t))})]}),(0,r.jsx)("div",{className:"chart-container",children:(0,r.jsx)("svg",{ref:a,className:"w-full h-full"})})]})}},1137:function(t,e,a){"use strict";a.d(e,{AuthProvider:function(){return o},a:function(){return c}});var r=a(7437),s=a(2265),n=a(9376),l=a(6023);let i=(0,s.createContext)(void 0);function o(t){let{children:e}=t,[a,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),m=(0,n.useRouter)(),u=(0,n.usePathname)(),p=["/login"];(0,s.useEffect)(()=>{x()},[]),(0,s.useEffect)(()=>{!c&&(a||p.includes(u)?a&&"/login"===u&&m.push("/"):m.push("/login"))},[a,c,u,m]);let x=async()=>{try{let t=l.e.getCurrentUser(),e=l.e.getToken();t&&e&&(await l.e.refreshToken()&&l.e.canAccessBloodBank()?o(t):(l.e.logout(),o(null)))}catch(t){console.error("Auth initialization failed:",t),l.e.logout(),o(null)}finally{d(!1)}},h=async(t,e)=>{try{let a=await l.e.login({email:t,password:e});if(!l.e.canAccessBloodBank())throw l.e.logout(),Error("You don't have permission to access the blood bank system.");o(a.user)}catch(t){throw t}};return(0,r.jsx)(i.Provider,{value:{user:a,isLoading:c,isAuthenticated:!!a,login:h,logout:()=>{l.e.logout(),o(null),m.push("/login")},canAccessBloodBank:()=>l.e.canAccessBloodBank(),canManageInventory:()=>l.e.canManageInventory(),canViewReports:()=>l.e.canViewReports(),canAccessForecasting:()=>l.e.canAccessForecasting(),canAccessOptimization:()=>l.e.canAccessOptimization()},children:e})}function c(){let t=(0,s.useContext)(i);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},6023:function(t,e,a){"use strict";a.d(e,{e:function(){return s}});let r=a(257).env.NEXT_PUBLIC_TRACK1_API_URL||"https://track1-production.up.railway.app";class s{static getAuthApiUrl(){return"".concat(r,"/api/auth")}static async login(t){let e=await fetch("".concat(this.getAuthApiUrl(),"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw Error((await e.json()).detail||"Login failed");let a=await e.json();return localStorage.setItem("access_token",a.access_token),localStorage.setItem("refresh_token",a.refresh_token),localStorage.setItem("user",JSON.stringify(a.user)),a}static async logout(){let t=localStorage.getItem("access_token");if(t)try{await fetch("".concat(this.getAuthApiUrl(),"/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({access_token:t})})}catch(t){console.error("Logout API call failed:",t)}localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}static getCurrentUser(){let t=localStorage.getItem("user");return t?JSON.parse(t):null}static getToken(){return localStorage.getItem("access_token")}static isAuthenticated(){return!!this.getToken()&&!!this.getCurrentUser()}static hasRole(t){let e=this.getCurrentUser();return(null==e?void 0:e.role)===t}static hasAnyRole(t){let e=this.getCurrentUser();return!!e&&t.includes(e.role)}static async refreshToken(){let t=localStorage.getItem("refresh_token");if(!t)return null;try{let e=await fetch("".concat(this.getAuthApiUrl(),"/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})});if(!e.ok)throw Error("Token refresh failed");let a=await e.json();return localStorage.setItem("access_token",a.access_token),localStorage.setItem("refresh_token",a.refresh_token),a.access_token}catch(t){return console.error("Token refresh failed:",t),this.logout(),null}}static canAccessBloodBank(){let t=this.getCurrentUser();return!!t&&["admin","doctor","nurse","staff"].includes(t.role)}static canManageInventory(){let t=this.getCurrentUser();return!!t&&(["admin","staff"].includes(t.role)||"nurse"===t.role&&"laboratory"===t.department)}static canViewReports(){let t=this.getCurrentUser();return!!t&&["admin","doctor","nurse","staff"].includes(t.role)}static canAccessForecasting(){let t=this.getCurrentUser();return!!t&&["admin","doctor"].includes(t.role)}static canAccessOptimization(){let t=this.getCurrentUser();return!!t&&(["admin"].includes(t.role)||"staff"===t.role&&"administration"===t.department)}}}},function(t){t.O(0,[763,415,347,648,971,117,744],function(){return t(t.s=7314)}),_N_E=t.O()}]);