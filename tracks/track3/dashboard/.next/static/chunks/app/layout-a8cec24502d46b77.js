(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3261:function(e,t,s){Promise.resolve().then(s.t.bind(s,7960,23)),Promise.resolve().then(s.bind(s,1137)),Promise.resolve().then(s.bind(s,1344))},1344:function(e,t,s){"use strict";s.d(t,{default:function(){return y}});var r=s(7437),n=s(2265),a=s(7648),o=s(9376),l=s(9637),i=s(7829),c=s(6221),d=s(8728),u=s(5805),h=s(4766),m=s(2369),x=s(7692),f=s(2489),g=s(8293),p=s(1137);function y(){let[e,t]=(0,n.useState)(!1),[s,y]=(0,n.useState)(!1),b=(0,o.usePathname)(),{user:v,logout:j,canManageInventory:N,canViewReports:k,canAccessForecasting:w,canAccessOptimization:A}=(0,p.a)();if("/login"===b||!v)return null;let _=(()=>{let e=[{name:"Dashboard",href:"/",icon:l.Z}];return N()&&e.push({name:"Inventory",href:"/inventory",icon:i.Z}),w()&&e.push({name:"Forecasting",href:"/forecasting",icon:c.Z}),A()&&e.push({name:"Optimization",href:"/optimization",icon:d.Z}),e.push({name:"Donors",href:"/donors",icon:u.Z}),k()&&e.push({name:"Reports",href:"/reports",icon:c.Z}),e})();return(0,r.jsxs)("nav",{className:"bg-white shadow-sm border-b border-gray-200 fixed w-full top-0 z-50",children:[(0,r.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,r.jsxs)(a.default,{href:"/",className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-sm",children:"\uD83E\uDE78"})}),(0,r.jsx)("span",{className:"font-bold text-xl text-gray-900",children:"BloodBank"})]})}),(0,r.jsx)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:_.map(e=>{let t=b===e.href;return(0,r.jsxs)(a.default,{href:e.href,className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors ".concat(t?"border-red-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:[(0,r.jsx)(e.icon,{className:"w-4 h-4 mr-2"}),e.name]},e.name)})})]}),(0,r.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:items-center space-x-4",children:[(0,r.jsxs)("button",{className:"relative p-2 text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-lg",children:[(0,r.jsx)(h.Z,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-400 ring-2 ring-white"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>y(!s),className:"flex items-center space-x-2 p-2 text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-lg",children:[(0,r.jsx)(m.Z,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:v.full_name})]}),s&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border border-gray-200",children:[(0,r.jsxs)("div",{className:"px-4 py-2 text-sm text-gray-700 border-b border-gray-100",children:[(0,r.jsx)("div",{className:"font-medium",children:v.full_name}),(0,r.jsx)("div",{className:"text-gray-500",children:v.email}),(0,r.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:v.role.charAt(0).toUpperCase()+v.role.slice(1)})]}),(0,r.jsxs)("button",{onClick:()=>{y(!1),j()},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4 inline mr-2"}),"Sign out"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Live"})]})]}),(0,r.jsx)("div",{className:"sm:hidden flex items-center",children:(0,r.jsx)("button",{onClick:()=>t(!e),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-500",children:e?(0,r.jsx)(f.Z,{className:"block h-6 w-6"}):(0,r.jsx)(g.Z,{className:"block h-6 w-6"})})})]})}),e&&(0,r.jsxs)("div",{className:"sm:hidden",children:[(0,r.jsx)("div",{className:"pt-2 pb-3 space-y-1 bg-white border-t border-gray-200",children:_.map(e=>{let s=b===e.href;return(0,r.jsx)(a.default,{href:e.href,className:"block pl-3 pr-4 py-2 border-l-4 text-base font-medium transition-colors ".concat(s?"bg-red-50 border-red-500 text-red-700":"border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700"),onClick:()=>t(!1),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(e.icon,{className:"w-5 h-5 mr-3"}),e.name]})},e.name)})}),(0,r.jsxs)("div",{className:"pt-4 pb-3 border-t border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center px-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(m.Z,{className:"h-8 w-8 text-gray-400"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("div",{className:"text-base font-medium text-gray-800",children:v.full_name}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:v.email}),(0,r.jsx)("div",{className:"text-xs text-blue-600",children:v.role.charAt(0).toUpperCase()+v.role.slice(1)})]}),(0,r.jsxs)("div",{className:"ml-auto flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Live"})]})]}),(0,r.jsx)("div",{className:"mt-3 px-4",children:(0,r.jsxs)("button",{onClick:j,className:"flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Sign out"]})})]})]})]})}},1137:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return i},a:function(){return c}});var r=s(7437),n=s(2265),a=s(9376),o=s(6023);let l=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0),u=(0,a.useRouter)(),h=(0,a.usePathname)(),m=["/login"];(0,n.useEffect)(()=>{x()},[]),(0,n.useEffect)(()=>{!c&&(s||m.includes(h)?s&&"/login"===h&&u.push("/"):u.push("/login"))},[s,c,h,u]);let x=async()=>{try{let e=o.e.getCurrentUser(),t=o.e.getToken();e&&t&&(await o.e.refreshToken()&&o.e.canAccessBloodBank()?i(e):(o.e.logout(),i(null)))}catch(e){console.error("Auth initialization failed:",e),o.e.logout(),i(null)}finally{d(!1)}},f=async(e,t)=>{try{let s=await o.e.login({email:e,password:t});if(!o.e.canAccessBloodBank())throw o.e.logout(),Error("You don't have permission to access the blood bank system.");i(s.user)}catch(e){throw e}};return(0,r.jsx)(l.Provider,{value:{user:s,isLoading:c,isAuthenticated:!!s,login:f,logout:()=>{o.e.logout(),i(null),u.push("/login")},canAccessBloodBank:()=>o.e.canAccessBloodBank(),canManageInventory:()=>o.e.canManageInventory(),canViewReports:()=>o.e.canViewReports(),canAccessForecasting:()=>o.e.canAccessForecasting(),canAccessOptimization:()=>o.e.canAccessOptimization()},children:t})}function c(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6023:function(e,t,s){"use strict";s.d(t,{e:function(){return n}});let r=s(257).env.NEXT_PUBLIC_TRACK1_API_URL||"https://track1-production.up.railway.app";class n{static getAuthApiUrl(){return"".concat(r,"/api/auth")}static async login(e){let t=await fetch("".concat(this.getAuthApiUrl(),"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).detail||"Login failed");let s=await t.json();return localStorage.setItem("access_token",s.access_token),localStorage.setItem("refresh_token",s.refresh_token),localStorage.setItem("user",JSON.stringify(s.user)),s}static async logout(){let e=localStorage.getItem("access_token");if(e)try{await fetch("".concat(this.getAuthApiUrl(),"/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({access_token:e})})}catch(e){console.error("Logout API call failed:",e)}localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}static getCurrentUser(){let e=localStorage.getItem("user");return e?JSON.parse(e):null}static getToken(){return localStorage.getItem("access_token")}static isAuthenticated(){return!!this.getToken()&&!!this.getCurrentUser()}static hasRole(e){let t=this.getCurrentUser();return(null==t?void 0:t.role)===e}static hasAnyRole(e){let t=this.getCurrentUser();return!!t&&e.includes(t.role)}static async refreshToken(){let e=localStorage.getItem("refresh_token");if(!e)return null;try{let t=await fetch("".concat(this.getAuthApiUrl(),"/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)throw Error("Token refresh failed");let s=await t.json();return localStorage.setItem("access_token",s.access_token),localStorage.setItem("refresh_token",s.refresh_token),s.access_token}catch(e){return console.error("Token refresh failed:",e),this.logout(),null}}static canAccessBloodBank(){let e=this.getCurrentUser();return!!e&&["admin","doctor","nurse","staff"].includes(e.role)}static canManageInventory(){let e=this.getCurrentUser();return!!e&&(["admin","staff"].includes(e.role)||"nurse"===e.role&&"laboratory"===e.department)}static canViewReports(){let e=this.getCurrentUser();return!!e&&["admin","doctor","nurse","staff"].includes(e.role)}static canAccessForecasting(){let e=this.getCurrentUser();return!!e&&["admin","doctor"].includes(e.role)}static canAccessOptimization(){let e=this.getCurrentUser();return!!e&&(["admin"].includes(e.role)||"staff"===e.role&&"administration"===e.department)}}},7960:function(){}},function(e){e.O(0,[587,727,971,117,744],function(){return e(e.s=3261)}),_N_E=e.O()}]);